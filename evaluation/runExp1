#! /bin/bash

# Copyright (c) 2011-2013 Peng Sun. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the COPYRIGHT file.

#instance=`ec2-describe-instances | grep $1 | cut -f3`
#echo "Server Instance is " $instance

#testserverIP=`ec2-describe-instances $instance | grep INSTANCE | cut -f18`
testserverIP=10.142.141.28
echo "Server internal IP " $testserverIP

for num in $(eval echo {0..9..1})
do
    echo $num
    temp=`expr $num + 1`
    result=`expr 1000 \* $temp`
    rm ../HostAgent/logs/*
    cd ec2scripts
    ./startHoneAgent &
    cd ..
    for port in $(eval echo {9001..`expr 9001 + $num`..1})
    do
        ./test_prog/test_prog $testserverIP $port 1000 &> /dev/null &
    done
    sleep 5m
    killall python
    killall test_prog
    cd ../HostAgent
    file=`ls logs/*.eval`
    cp $file ../evaluation/exp1data/conn$result.log
    #file=`ls logs/*.txt`
    #cp $file ../evaluation/exp1data/cpumem_conn$result.txt
    cd ../evaluation
    python parseexp1.py exp1data/conn$result.log
    echo "done " $num
    sleep 10s
done
